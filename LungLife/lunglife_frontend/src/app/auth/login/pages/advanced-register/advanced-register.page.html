<ion-content class="ion-padding">
  <div class="register-container">
    <div class="header-section">
      <img src="assets/images/logo.png" alt="LungLife" class="logo">
      <h1>Crear Cuenta</h1>
      <p>Únete a LungLife y protege tu salud respiratoria</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onRegister()">
      <!-- Información Personal -->
      <div class="form-section">
        <h3>Información Personal</h3>

        <ion-item class="form-item">
          <ion-label position="stacked">Nombre *</ion-label>
          <ion-input
            formControlName="nombre"
            placeholder="Tu nombre"
            [class.ion-invalid]="isFieldInvalid('nombre')"
          ></ion-input>
          <ion-note slot="error" *ngIf="registerForm.get('nombre')?.hasError('required')">
            El nombre es requerido
          </ion-note>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="stacked">Apellido</ion-label>
          <ion-input
            formControlName="apellido"
            placeholder="Tu apellido"
            [class.ion-invalid]="isFieldInvalid('apellido')"
          ></ion-input>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="stacked">Email *</ion-label>
          <ion-input
            formControlName="email"
            type="email"
            placeholder="tu@email.com"
            [class.ion-invalid]="isFieldInvalid('email')"
          ></ion-input>
          <ion-note slot="error" *ngIf="registerForm.get('email')?.hasError('required')">
            El email es requerido
          </ion-note>
          <ion-note slot="error" *ngIf="registerForm.get('email')?.hasError('email')">
            Ingresa un email válido
          </ion-note>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="stacked">Teléfono (Opcional)</ion-label>
          <ion-input
            formControlName="telefono"
            type="tel"
            placeholder="+56912345678"
            [class.ion-invalid]="isFieldInvalid('telefono')"
          ></ion-input>
          <ion-note slot="error" *ngIf="registerForm.get('telefono')?.hasError('phoneNumber')">
            Formato: +[código país][número] (ej: +56912345678)
          </ion-note>
        </ion-item>
      </div>

      <!-- Seguridad -->
      <div class="form-section">
        <h3>Seguridad</h3>

        <ion-item class="form-item">
          <ion-label position="stacked">Contraseña *</ion-label>
          <ion-input
            formControlName="password"
            [type]="showPassword ? 'text' : 'password'"
            placeholder="Mínimo 8 caracteres"
            [class.ion-invalid]="isFieldInvalid('password')"
          ></ion-input>
          <ion-button fill="clear" slot="end" (click)="togglePassword()">
            <ion-icon [name]="showPassword ? 'eye-off' : 'eye'"></ion-icon>
          </ion-button>
          <div class="password-requirements" *ngIf="registerForm.get('password')?.touched">
            <div class="requirement" [class.met]="passwordChecks.minLength">
              <ion-icon [name]="passwordChecks.minLength ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              Mínimo 8 caracteres
            </div>
            <div class="requirement" [class.met]="passwordChecks.uppercase">
              <ion-icon [name]="passwordChecks.uppercase ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              Una mayúscula
            </div>
            <div class="requirement" [class.met]="passwordChecks.lowercase">
              <ion-icon [name]="passwordChecks.lowercase ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              Una minúscula
            </div>
            <div class="requirement" [class.met]="passwordChecks.number">
              <ion-icon [name]="passwordChecks.number ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              Un número
            </div>
            <div class="requirement" [class.met]="passwordChecks.special">
              <ion-icon [name]="passwordChecks.special ? 'checkmark-circle' : 'close-circle'"></ion-icon>
              Un carácter especial
            </div>
          </div>
        </ion-item>

        <ion-item class="form-item">
          <ion-label position="stacked">Confirmar Contraseña *</ion-label>
          <ion-input
            formControlName="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            placeholder="Repite tu contraseña"
            [class.ion-invalid]="isFieldInvalid('confirmPassword')"
          ></ion-input>
          <ion-button fill="clear" slot="end" (click)="toggleConfirmPassword()">
            <ion-icon [name]="showConfirmPassword ? 'eye-off' : 'eye'"></ion-icon>
          </ion-button>
          <ion-note slot="error" *ngIf="registerForm.get('confirmPassword')?.hasError('confirmPassword')">
            Las contraseñas no coinciden
          </ion-note>
        </ion-item>
      </div>

      <!-- Términos y Condiciones -->
      <div class="form-section">
        <h3>Términos y Condiciones</h3>

        <ion-item class="checkbox-item" [class.ion-invalid]="isFieldInvalid('acceptTerms')">
          <ion-checkbox formControlName="acceptTerms"></ion-checkbox>
          <ion-label class="ion-margin-start">
            Acepto los
            <a href="/terms" target="_blank">Términos y Condiciones</a>
          </ion-label>
        </ion-item>

        <ion-item class="checkbox-item" [class.ion-invalid]="isFieldInvalid('acceptPrivacy')">
          <ion-checkbox formControlName="acceptPrivacy"></ion-checkbox>
          <ion-label class="ion-margin-start">
            Acepto la
            <a href="/privacy" target="_blank">Política de Privacidad</a>
          </ion-label>
        </ion-item>

        <ion-item class="checkbox-item">
          <ion-checkbox formControlName="acceptMarketing"></ion-checkbox>
          <ion-label class="ion-margin-start">
            Deseo recibir comunicaciones de marketing (opcional)
          </ion-label>
        </ion-item>
      </div>

      <ion-button
        expand="block"
        type="submit"
        [disabled]="!registerForm.valid || loading"
        class="register-button"
      >
        <ion-spinner *ngIf="loading" name="crescent"></ion-spinner>
        {{ loading ? 'Creando cuenta...' : 'Crear Cuenta' }}
      </ion-button>
    </form>

    <!-- Error display -->
    <ion-item *ngIf="error" color="danger" class="error-item">
      <ion-icon name="alert-circle" slot="start"></ion-icon>
      <ion-label>{{ error }}</ion-label>
    </ion-item>

    <!-- Login link -->
    <div class="login-link">
      <p>
        ¿Ya tienes cuenta?
        <ion-button fill="clear" routerLink="/auth/login">
          Inicia sesión aquí
        </ion-button>
      </p>
    </div>
  </div>
</ion-content>
